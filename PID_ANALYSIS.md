# P æ§åˆ¶ vs PID æ§åˆ¶åˆ†æ

## å½“å‰ç³»ç»Ÿï¼ˆP æ§åˆ¶ï¼‰

```python
T_diff = kp_yaw * e_yaw
```

**ä¼˜ç‚¹ï¼š**
- âœ… ç®€å•ç›´æ¥ï¼Œæ˜“äºè°ƒè¯•
- âœ… ååº”å¿«é€Ÿï¼Œå»¶è¿Ÿä½
- âœ… å®é™…æ•ˆæœä¸é”™ï¼ˆä½ å·²éªŒè¯ï¼‰
- âœ… å¯¹å¿«é€Ÿå˜åŒ–çš„ç›®æ ‡å“åº”å¥½

**ç¼ºç‚¹ï¼š**
- âŒ æœ‰ç¨³æ€è¯¯å·®ï¼ˆæ°¸è¿œä¸èƒ½å®Œå…¨å¯¹é½ç›®æ ‡èˆªå‘ï¼‰
- âŒ åœ¨é£æµªä¸­å®¹æ˜“åç¦»
- âŒ æ— æ³•æ¶ˆé™¤æŒç»­çš„å¤–åŠ›å¹²æ‰°

---

## å¦‚æœæ”¹ç”¨ PID æ§åˆ¶

### å®Œæ•´ PID æ§åˆ¶å…¬å¼

```python
# åˆå§‹åŒ–
integral_error = 0
last_error = 0

# æ§åˆ¶å¾ªç¯ï¼ˆæ¯ 50ms æ‰§è¡Œä¸€æ¬¡ï¼Œdt = 0.05sï¼‰
dt = 0.05
e_yaw = desired_yaw - current_yaw

# P é¡¹ï¼šæ¯”ä¾‹é¡¹ï¼ˆç«‹å³å“åº”ï¼‰
P = kp_yaw * e_yaw

# I é¡¹ï¼šç§¯åˆ†é¡¹ï¼ˆæ¶ˆé™¤ç¨³æ€è¯¯å·®ï¼‰
integral_error += e_yaw * dt
I = ki_yaw * integral_error

# D é¡¹ï¼šå¾®åˆ†é¡¹ï¼ˆå‡å°‘éœ‡è¡ï¼‰
D = kd_yaw * (e_yaw - last_error) / dt
last_error = e_yaw

# æ€»æ§åˆ¶è¾“å‡º
T_diff = P + I + D
```

### å„é¡¹ä½œç”¨è¯¦è§£

#### P é¡¹ï¼ˆæ¯”ä¾‹æ§åˆ¶ï¼‰
```
è¯¯å·® = -0.1 rad
P_output = 600 Ã— (-0.1) = -60 N

ç‰¹æ€§ï¼š
- è¯¯å·®è¶Šå¤§ï¼ŒçŸ«æ­£è¶Šå¼º
- ä½†æ°¸è¿œæ— æ³•å®Œå…¨æ¶ˆé™¤è¯¯å·®
- å®æ—¶å“åº”å¿«
```

#### I é¡¹ï¼ˆç§¯åˆ†æ§åˆ¶ï¼‰
```
åœºæ™¯ï¼šæŒç»­ 0.1 rad åå·® 10 ç§’
âˆ«e_yaw dt = 0.1 Ã— 10 = 1.0 radÂ·s

I_output = ki_yaw Ã— 1.0
å¦‚æœ ki_yaw = 50ï¼Œåˆ™ I_output = 50 N

ä½œç”¨ï¼š
- è‡ªåŠ¨è°ƒæ•´ T_diffï¼Œç›´åˆ°è¯¯å·®ä¸º 0
- æ¶ˆé™¤ç¨³æ€è¯¯å·®
- ä½†å“åº”ç¼“æ…¢ï¼Œå®¹æ˜“å¯¼è‡´è¶…è°ƒ
```

#### D é¡¹ï¼ˆå¾®åˆ†æ§åˆ¶ï¼‰
```
åœºæ™¯ï¼šè¯¯å·®å¿«é€Ÿå˜åŒ–
de_yaw/dt = (0.15 - 0.10) / 0.05 = 1.0 rad/s

D_output = kd_yaw Ã— 1.0
å¦‚æœ kd_yaw = 100ï¼Œåˆ™ D_output = 100 N

ä½œç”¨ï¼š
- é¢„æµ‹æœªæ¥è¶‹åŠ¿
- å‡å°‘è¶…è°ƒå’Œéœ‡è¡
- ä½†å¯¹å™ªå£°æ•æ„Ÿ
```

---

## ä¸‰ç§æ§åˆ¶æ–¹å¼å¯¹æ¯”

### 1. P æ§åˆ¶ï¼ˆå½“å‰ç³»ç»Ÿï¼‰

```
å“åº”æ›²çº¿ï¼š
      ç›®æ ‡èˆªå‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   â•±â”€â”€â”€â”€â”€â•²
ç”µæµèˆªå‘  â”€â”€â”€â”€â”€â”€â”€â•±       â•²â”€â”€â”€â”€â”€â”€ (ç¨³æ€è¯¯å·®)
          
æ—¶é—´ â†’

ç‰¹æ€§ï¼š
- å¿«é€Ÿå“åº” âœ…
- æœ‰ç¨³æ€è¯¯å·® âŒ
- å®é™…æ•ˆæœå¥½ âœ… (ä½ éªŒè¯è¿‡)
```

**é€‚ç”¨åœºæ™¯ï¼š** ä½ ç°åœ¨çš„åœºæ™¯ï¼å¿«é€Ÿååº”æ¯”å®Œç¾å¯¹é½æ›´é‡è¦

---

### 2. PI æ§åˆ¶ï¼ˆæ¯”ä¾‹ + ç§¯åˆ†ï¼‰

```
å“åº”æ›²çº¿ï¼š
      ç›®æ ‡èˆªå‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   â•±â”€â”€â”€â”€â”€â”€â”€â”€\
ç”µæµèˆªå‘  â”€â”€â”€â”€â”€â”€â”€â•±          â•²â”€â”€â”€ (æ— ç¨³æ€è¯¯å·®)
          
æ—¶é—´ â†’

ç‰¹æ€§ï¼š
- æ— ç¨³æ€è¯¯å·® âœ…
- å“åº”æ…¢ä¸€äº› âš ï¸
- å®¹æ˜“è¶…è°ƒ âŒ
```

**é€‚ç”¨åœºæ™¯ï¼š** éœ€è¦ç²¾ç¡®å¯¹é½ï¼Œä½†é£å¹³æµªé™

---

### 3. PID æ§åˆ¶ï¼ˆæ¯”ä¾‹ + ç§¯åˆ† + å¾®åˆ†ï¼‰

```
å“åº”æ›²çº¿ï¼š
      ç›®æ ‡èˆªå‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   â•±â”€â”€â”€â”€â”€\
ç”µæµèˆªå‘  â”€â”€â”€â”€â”€â”€â”€â•±       â•²â”€â”€â”€â”€ (å¿«é€Ÿæ”¶æ•›ï¼Œæ— è¶…è°ƒ)
          
æ—¶é—´ â†’

ç‰¹æ€§ï¼š
- å¿«é€Ÿå“åº” âœ…
- æ— ç¨³æ€è¯¯å·® âœ…
- æ— è¶…è°ƒ âœ…
- è°ƒå‚å¤æ‚ âŒ
```

**é€‚ç”¨åœºæ™¯ï¼š** é«˜ç²¾åº¦å¯¼èˆªï¼Œå·²çŸ¥ç¯å¢ƒå‚æ•°

---

## å®é™…ä¾‹å­ï¼šèˆ¹è½¬å‘ 90Â°

### P æ§åˆ¶ï¼ˆkp_yaw = 600ï¼‰

```
æ—¶é—´ 0s:   è¯¯å·® = 1.57 rad (90Â°)
           T_diff = 600 Ã— 1.57 = 942 N
           å·¦æ¨ = 400 - 942 = -542 N (åå‘)
           å³æ¨ = 400 + 942 = 1342 N
           â†’ å¿«é€Ÿæ—‹è½¬

æ—¶é—´ 1s:   è¯¯å·® = 0.2 rad (11Â°)
           T_diff = 600 Ã— 0.2 = 120 N
           å·¦æ¨ = 280 N, å³æ¨ = 520 N
           â†’ ç»§ç»­è½¬å‘ï¼Œé€Ÿåº¦å˜æ…¢

æ—¶é—´ 2s:   è¯¯å·® = 0.05 rad (3Â°)
           T_diff = 30 N
           â†’ ç»§ç»­å¾®è°ƒï¼Œæ°¸ä¸å®Œå…¨å¯¹é½

ç¼ºç‚¹ï¼š
- æ°¸è¿œä¿æŒ 3Â° å·¦å³çš„åå·®ï¼ˆé™¤éæœ‰å…¶ä»–åŠ›è¡¥å¿ï¼‰
```

### PID æ§åˆ¶ï¼ˆkp=600, ki=50, kd=100ï¼‰

```
æ—¶é—´ 0s:   e = 1.57 rad, de/dt = 0
           P = 942 N, I = 0, D = 0
           T_diff = 942 N
           â†’ å¼ºåŠ²è½¬å‘

æ—¶é—´ 0.5s: e = 0.8 rad, de/dt = -1.54
           P = 480 N
           I = 50 Ã— (1.57+0.8) Ã— 0.5 = 58.5 N  (å¼€å§‹ç§¯ç´¯)
           D = 100 Ã— (-1.54) = -154 N  (å‡é€Ÿ)
           T_diff = 480 + 58.5 - 154 = 384.5 N
           â†’ è½¬å‘ï¼Œä½†å¹³é¡ºå¾ˆå¤š

æ—¶é—´ 1.5s: e = 0.1 rad, de/dt = 0
           P = 60 N
           I = 50 Ã— (ç§¯åˆ†å€¼) â‰ˆ 100 N  (ç»§ç»­æ¨ï¼‰
           D = 0
           T_diff â‰ˆ 160 N
           â†’ ç§¯åˆ†å¸®å¿™æ¶ˆé™¤æœ€åçš„è¯¯å·®

æ—¶é—´ 2s:   e â‰ˆ 0, de/dt â‰ˆ 0
           P â‰ˆ 0, I â‰ˆ 0, D â‰ˆ 0
           T_diff â‰ˆ 0
           â†’ å®Œå…¨å¯¹é½ï¼âœ…
```

---

## ä½ çš„æƒ…å†µä¸‹åº”è¯¥æ€ä¹ˆé€‰ï¼Ÿ

### ç°åœ¨ï¼ˆP æ§åˆ¶ï¼‰çš„ä¼˜åŠ¿ï¼š
- âœ… èˆ¹å¿«é€Ÿååº”ç›®æ ‡å˜åŒ–
- âœ… æ¿€å…‰é›·è¾¾é¿éšœæ—¶èƒ½å¿«é€Ÿè°ƒæ•´
- âœ… ä½å»¶è¿Ÿï¼Œé€‚åˆåŠ¨æ€ç¯å¢ƒ
- âœ… ä½ å·²ç»éªŒè¯æ•ˆæœä¸é”™

### ä»€ä¹ˆæ—¶å€™è€ƒè™‘ PIDï¼Ÿ

```
ä½ åº”è¯¥æ”¹ç”¨ PIDï¼Œå¦‚æœï¼š
1. éœ€è¦æ›´ç²¾ç¡®çš„æœ€ç»ˆä½ç½®å¯¹é½
2. æµ·é¢é£æµªå¯¼è‡´æŒç»­åç¦»
3. éœ€è¦è‡ªåŠ¨è¿½è¸ªåŠ¨æ€ç›®æ ‡
4. å¯ä»¥æ¥å—ç¨å¾®å¤æ‚çš„å‚æ•°è°ƒæ•´
```

### ä¿æŒ P æ§åˆ¶ï¼Œå¦‚æœï¼š
```
âœ… å½“å‰æ•ˆæœæ»¡è¶³ä»»åŠ¡éœ€æ±‚
âœ… æ›´å…³å¿ƒå¿«é€Ÿååº”è€Œéå®Œç¾å¯¹é½
âœ… ç¯å¢ƒå¤šå˜ï¼Œéœ€è¦ä½å»¶è¿Ÿå†³ç­–
âœ… ä¸æƒ³å¢åŠ è°ƒå‚å¤æ‚æ€§
```

---

## å¦‚æœä½ æƒ³è¯•è¯• PIDï¼Œè¿™æ˜¯æ”¹æ³•

**ç¬¬ 885 è¡Œé™„è¿‘ï¼Œå½“å‰ä»£ç ï¼š**
```python
T_forward = self.forward_thrust
if self.approach_slow_dist > 0.0:
    T_forward *= max(0.1, min(1.0, dist / self.approach_slow_dist))
T_diff = self.kp_yaw * e_yaw  # â† åªæœ‰ P é¡¹

left_cmd = T_forward - T_diff
right_cmd = T_forward + T_diff
```

**æ”¹ä¸º PIDï¼š**
```python
# åœ¨ __init__ ä¸­æ·»åŠ ï¼ˆç¬¬ 1 æ¬¡ï¼‰
self.integral_error_yaw = 0.0
self.last_e_yaw = 0.0
self.ki_yaw = self.declare_parameter('ki_yaw', 50.0).value
self.kd_yaw = self.declare_parameter('kd_yaw', 100.0).value

# åœ¨ control_loop ä¸­æ”¹ä¸ºï¼ˆç¬¬ 2 æ¬¡ï¼‰
T_forward = self.forward_thrust
if self.approach_slow_dist > 0.0:
    T_forward *= max(0.1, min(1.0, dist / self.approach_slow_dist))

# PID æ§åˆ¶
dt = 0.05  # 20Hz æ§åˆ¶é¢‘ç‡
self.integral_error_yaw += e_yaw * dt
self.integral_error_yaw = max(-1.0, min(1.0, self.integral_error_yaw))  # æŠ—ç§¯åˆ†é¥±å’Œ

P_term = self.kp_yaw * e_yaw
I_term = self.ki_yaw * self.integral_error_yaw
D_term = self.kd_yaw * (e_yaw - self.last_e_yaw) / dt

T_diff = P_term + I_term + D_term
self.last_e_yaw = e_yaw

left_cmd = T_forward - T_diff
right_cmd = T_forward + T_diff
```

---

## æ€»ç»“å»ºè®®

| æ–¹é¢ | P æ§åˆ¶ | PID æ§åˆ¶ |
|------|--------|---------|
| **å“åº”é€Ÿåº¦** | å¿« âœ… | å¿« âœ… |
| **ç¨³æ€è¯¯å·®** | æœ‰ âŒ | æ—  âœ… |
| **è°ƒå‚éš¾åº¦** | ç®€å• âœ… | å¤æ‚ âŒ |
| **æŠ—å¹²æ‰°èƒ½åŠ›** | ä¸­ âš ï¸ | å¼º âœ… |
| **å½“å‰é€‚ç”¨** | **æ¨è** âœ… | åç»­è€ƒè™‘ |

**æˆ‘çš„å»ºè®®ï¼š**
- ğŸ‘ **ç°åœ¨ä¿æŒ P æ§åˆ¶** - æ—¢ç„¶æ•ˆæœä¸é”™ï¼Œå°±ä¸è¦åŠ¨
- ğŸ“ **è®°å½•è¿™ä¸ª PID æ–¹æ¡ˆ** - å¦‚æœå°†æ¥éœ€è¦æ›´ç²¾ç¡®æ§åˆ¶ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œ
- ğŸ¯ **é‡ç‚¹ç¡®ä¿ç›®æ ‡åæ ‡è®¡ç®—æ­£ç¡®** - è¿™æ¯” PID æ›´é‡è¦ï¼

